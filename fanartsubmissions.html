<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fan Art Submissions Admin</title>
<style>
  body {
    font-family: 'Comic Sans MS', sans-serif;
    background: linear-gradient(to bottom right, #fffbe6, #ffd9d9);
    color: #333;
    padding: 30px;
  }
  h1 {
    color: #ff0000;
    text-align: center;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
  }
  .submission {
    background: white;
    border: 3px solid #ffd500;
    border-radius: 20px;
    padding: 20px;
    margin: 20px auto;
    max-width: 700px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.1);
  }
  .submission h2 {
    margin: 0 0 10px 0;
    color: #ff0000;
  }
  .submission p {
    margin: 5px 0;
  }
  .submission img {
    max-width: 100%;
    border-radius: 15px;
    margin: 10px 0;
  }
  .btn {
    padding: 8px 15px;
    margin-right: 10px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    font-weight: bold;
  }
  .approve-btn {
    background: linear-gradient(to right, #4CAF50, #80e27e);
    color: white;
  }
  .deny-btn {
    background: linear-gradient(to right, #ff0000, #ff6666);
    color: white;
  }
  .reason-input {
    display: none;
    margin-top: 10px;
    width: 100%;
    padding: 8px;
    border-radius: 10px;
    border: 2px solid #ffd500;
  }
</style>
</head>
<body>
<h1>Fan Art Submissions Admin</h1>
<div id="submissionsContainer"></div>

<!-- Firebase SDK -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-app.js";
import { getFirestore, collection, getDocs, doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-firestore.js";

// Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyCGIfsNq5MSv3tU46xjmDXKcsJM6LBXxUE",
  authDomain: "stormy-and-hops.firebaseapp.com",
  projectId: "stormy-and-hops",
  storageBucket: "stormy-and-hops.appspot.com",
  messagingSenderId: "227495295577",
  appId: "1:227495295577:web:4928330cefefba09a50f48",
  measurementId: "G-LTJ1P6QB6Y"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const submissionsContainer = document.getElementById("submissionsContainer");

// Load submissions from Firestore
async function loadSubmissions() {
  submissionsContainer.innerHTML = "";
  const querySnapshot = await getDocs(collection(db, "fanArtSubmissions"));
  querySnapshot.forEach(docSnap => {
    const data = docSnap.data();
    const submissionId = docSnap.id;

    const div = document.createElement("div");
    div.className = "submission";

    div.innerHTML = `
      <h2>${data.title}</h2>
      <p><strong>Artist:</strong> ${data.name} (${data.discord})</p>
      <p><strong>Description:</strong> ${data.desc || "None"}</p>
      ${data.fileUrl ? `<img src="${data.fileUrl}" alt="${data.title}">` : ""}
      <p><strong>Status:</strong> <span id="status-${submissionId}">${data.status || "Pending"}</span></p>
      <input type="text" class="reason-input" id="reason-${submissionId}" placeholder="Reason for denial">
      <button class="btn approve-btn" onclick="approve('${submissionId}')">Approve</button>
      <button class="btn deny-btn" onclick="showReasonInput('${submissionId}')">Deny</button>
      <button class="btn deny-btn" id="submitReasonBtn-${submissionId}" style="display:none;" onclick="deny('${submissionId}')">Submit Denial</button>
    `;
    submissionsContainer.appendChild(div);
  });
}

// Approve function
async function approve(id) {
  const statusEl = document.getElementById(`status-${id}`);
  await updateDoc(doc(db, "fanArtSubmissions", id), { status: "Approved", denialReason: "" });
  statusEl.textContent = "Approved";
}

// Show denial input
function showReasonInput(id) {
  document.getElementById(`reason-${id}`).style.display = "block";
  document.getElementById(`submitReasonBtn-${id}`).style.display = "inline-block";
}

// Deny function
async function deny(id) {
  const reason = document.getElementById(`reason-${id}`).value.trim();
  if (!reason) {
    alert("Please provide a reason for denial.");
    return;
  }
  const statusEl = document.getElementById(`status-${id}`);
  await updateDoc(doc(db, "fanArtSubmissions", id), { status: "Denied", denialReason: reason });
  statusEl.textContent = `Denied - Reason: ${reason}`;
  document.getElementById(`reason-${id}`).style.display = "none";
  document.getElementById(`submitReasonBtn-${id}`).style.display = "none";
}

// Load submissions on page load
loadSubmissions();
</script>
</body>
</html>
