<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fan Art Submissions - Admin</title>
<style>
  body {
    font-family: 'Comic Sans MS', sans-serif;
    background: linear-gradient(to bottom right, #fffbe6, #ffd9d9);
    margin: 0;
    padding: 30px;
    text-align: center;
  }
  h1 {
    color: #ff0000;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
  }
  .submission {
    background: white;
    border: 3px solid #ffd500;
    border-radius: 20px;
    padding: 20px;
    margin: 20px auto;
    max-width: 600px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.1);
    text-align: left;
  }
  .submission img {
    width: 100%;
    border-radius: 15px;
    margin-top: 10px;
  }
  .btn {
    border: none;
    border-radius: 10px;
    padding: 10px 20px;
    font-weight: bold;
    cursor: pointer;
    margin-right: 10px;
    transition: 0.3s;
  }
  .approve {
    background: #4CAF50;
    color: white;
  }
  .approve:hover { background: #45a049; }
  .deny {
    background: #ff4444;
    color: white;
  }
  .deny:hover { background: #ff6666; }
  .reason-box {
    margin-top: 10px;
    display: none;
  }
  textarea {
    width: 100%;
    height: 60px;
    border: 2px solid #ffd500;
    border-radius: 10px;
    padding: 5px;
  }
  .status {
    font-weight: bold;
    margin-top: 5px;
  }
</style>
</head>
<body>
  <h1>üé® Fan Art Submissions (Admin)</h1>
  <div id="submissionsList">Loading submissions...</div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-app.js";
    import { getFirestore, collection, getDocs, updateDoc, doc } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCGIfsNq5MSv3tU46xjmDXKcsJM6LBXxUE",
      authDomain: "stormy-and-hops.firebaseapp.com",
      projectId: "stormy-and-hops",
      storageBucket: "stormy-and-hops.appspot.com",
      messagingSenderId: "227495295577",
      appId: "1:227495295577:web:4928330cefefba09a50f48",
      measurementId: "G-LTJ1P6QB6Y"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const submissionsList = document.getElementById('submissionsList');

    async function loadSubmissions() {
      submissionsList.innerHTML = "";
      const querySnapshot = await getDocs(collection(db, "fanArtSubmissions"));
      if (querySnapshot.empty) {
        submissionsList.innerHTML = "<p>No fan art submissions yet.</p>";
        return;
      }

      querySnapshot.forEach((docSnap) => {
        const data = docSnap.data();
        const div = document.createElement('div');
        div.className = 'submission';
        div.innerHTML = `
          <p><strong>Name:</strong> ${data.name}</p>
          <p><strong>Discord:</strong> ${data.discord}</p>
          <p><strong>Title:</strong> ${data.title}</p>
          <p><strong>Description:</strong> ${data.desc || "(none)"}</p>
          <img src="${data.fileUrl}" alt="${data.title}">
          <p class="status">Status: ${data.status}</p>

          <button class="btn approve">Approve</button>
          <button class="btn deny">Deny</button>

          <div class="reason-box">
            <textarea placeholder="Reason for denial..."></textarea>
            <button class="btn deny">Confirm Deny</button>
          </div>
        `;

        const approveBtn = div.querySelector('.approve');
        const denyBtn = div.querySelectorAll('.deny')[0];
        const reasonBox = div.querySelector('.reason-box');
        const confirmDenyBtn = div.querySelectorAll('.deny')[1];

        // Approve
        approveBtn.addEventListener('click', async () => {
          await updateDoc(doc(db, "fanArtSubmissions", docSnap.id), {
            status: "Approved",
            denialReason: ""
          });
          div.querySelector('.status').textContent = "Status: Approved ‚úÖ";
          approveBtn.remove();
          denyBtn.remove();
          reasonBox.remove();
        });

        // Deny (show reason box)
        denyBtn.addEventListener('click', () => {
          reasonBox.style.display = 'block';
        });

        // Confirm deny
        confirmDenyBtn.addEventListener('click', async () => {
          const reason = reasonBox.querySelector('textarea').value.trim();
          if (!reason) {
            alert("Please enter a reason for denial.");
            return;
          }
          await updateDoc(doc(db, "fanArtSubmissions", docSnap.id), {
            status: "Denied ‚ùå",
            denialReason: reason
          });
          div.querySelector('.status').textContent = "Status: Denied ‚ùå Reason: " + reason;
          reasonBox.style.display = 'none';
          approveBtn.remove();
          denyBtn.remove();
        });

        submissionsList.appendChild(div);
      });
    }

    loadSubmissions();
  </script>
</body>
</html>
